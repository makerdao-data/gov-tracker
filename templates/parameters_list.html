<!DOCTYPE html>
<html lang="en">
<head>
    <head>
        {% include 'head.html' %}
    </head>
</head>
<body>
    <div class="parameters_dashboard">

        <div class="header shadow">
            {% include 'header.html' %}
        </div>


            <div class="right_panel shadow">
                <div id="table_container">
                    <div><h3 style="margin-top: 10px; margin-left: 5px;">Available protocol parameters list</h3></div>

                    <div class="right-box">
                        <table id="sorted-table" class="simple-table dataTable no-footer" style="width:99%">
                            <thead>
                                <tr>
                                    <th>DICU parameter name</th>
                                    <th>Contract</th>
                                    <th>Parameter</th>
                                    <th>Info</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>

        <div class="footer shadow">
            {% include 'footer.html' %}
        </div>
    </div>

    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='daterangepicker.css') }}" />

    <script>

        $(document).ready(function() {

        $.ajax({
            url: "/data/protocol_parameters_list",
            method: 'get',
            dataType: 'json',
            contentType: 'application/json',
            success: function (msg) {

                if (msg.status === "success") {

                    const data = msg.data

                    $('#sorted-table').DataTable( {
                        data: data['parameters'],
                        autoWidth: false,
                        columns: [
                            { data: "DICU_PARAMETER_NAME" },
                            { data: "CONTRACT", width: '75px' },
                            { data: "PARAMETER" },
                            { data: "INFO", width: '65px' }
                        ],
                        order: [[ 1, "desc" ]],
                        lengthMenu: [[20, 50, 100, -1], [20, 50, 100, "All"]],
                        pageLength: 50,
                        dom: 'lBfrtip',
                        buttons: [ {
                            extend: 'csv',
                            text: 'Export to CSV',
                            filename: 'parameters',
                            exportOptions: {
                                modifier: {
                                    search: 'none'
                                }
                            }
                        } ]
                    });

                    $( "#sorted-table" ).removeClass();
                    $( "#sorted-table" ).addClass("simple-table");
                    $( "#sorted-table" ).addClass("dataTable");
                    $( "#sorted-table" ).addClass("no-footer");
                    $( "#cover" ).css("display", "none");
                    $( "#table_container" ).css("visibility", "visible");

                } else {
                    const error_message = `
                    <div style="padding: 10px; margin-bottom: 50px">
                        <h2>Problem while fetching data :(<br>
                        Please try again</h2>
                    </div>`;
                    $( "#data_html" ).html(error_message);
                    $( "#table_container" ).html(error_message);
                }

            },
            error: function (ex) {
                const error_message = `
                <div style="padding-left: 50px; margin-top: 50px; margin-bottom: 50px">
                    <h2>Something went wrong :(<br>
                    Try again later</h2>
                </div>`;
                $( "#dashboard" ).html(error_message);
            }
        });
        });
            
    </script>

</body>
</html>